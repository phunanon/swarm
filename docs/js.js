/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/***/ (function() {


var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var help = [
    'Click to toggle visible updates',
    'spacebar to move home to cursor',
];
var scale = 6;
var speed = 1;
var screamRadius = 12;
var ants = [];
var foods = [];
var newHome = { x: 0, y: 0 };
var home = { x: 0, y: 0, radius: 4 };
var collected = 0;
var showUpdates = true;
var helpOpacity = 1;
var w = function () { return document.body.offsetWidth / scale; };
var h = function () { return document.body.offsetHeight / scale; };
window.addEventListener('DOMContentLoaded', function () {
    var _a;
    var ctx = (_a = document.querySelector('canvas')) === null || _a === void 0 ? void 0 : _a.getContext('2d');
    if (!ctx)
        return;
    ctx.canvas.addEventListener('mousemove', function (e) {
        newHome.x = e.offsetX / scale;
        newHome.y = e.offsetY / scale;
    });
    document.body.addEventListener('mousedown', function (e) {
        showUpdates = !showUpdates;
    });
    document.body.addEventListener('keyup', function (e) {
        if (e.key === ' ') {
            home.x = newHome.x;
            home.y = newHome.y;
        }
    });
    ants.push.apply(ants, new Array(400).fill(0).map(function () { return (__assign(__assign({ x: Math.random() * w(), y: Math.random() * h() }, { home: 0, food: 0, carrying: false }), { direction: Math.random() * Math.PI * 2 })); }));
    foods.push.apply(foods, new Array(4).fill(0).map(function () { return ({
        x: Math.random() * w(),
        y: Math.random() * h(),
        radius: 4,
        direction: Math.random() * Math.PI * 2,
    }); }));
    home.x = 32;
    home.y = h() / 2;
    Render(ctx);
});
var Render = function (ctx) {
    var width = document.body.offsetWidth;
    var height = document.body.offsetHeight;
    ctx.canvas.style.width = "".concat((ctx.canvas.width = width));
    ctx.canvas.style.height = "".concat((ctx.canvas.height = height));
    ctx.fillStyle = 'rgba(128, 128, 128, 1)';
    ctx.fillRect(0, 0, width, height);
    ctx.save();
    ctx.scale(scale, scale);
    var updates = Update();
    updates.forEach(function (_a) {
        var x1 = _a[0], y1 = _a[1], x2 = _a[2], y2 = _a[3], food = _a[4];
        ctx.strokeStyle = "rgba(0, ".concat(food ? 0 : 255, ", ").concat(food ? 255 : 0, ", 0.1)");
        ctx.beginPath();
        ctx.moveTo(x1 + 0.5, y1 + 0.5);
        ctx.lineTo(x2 + 0.5, y2 + 0.5);
        ctx.stroke();
    });
    ants.forEach(function (ant) {
        ctx.fillStyle = ant.carrying ? 'white' : 'black';
        ctx.fillRect(ant.x, ant.y, 1, 1);
    });
    foods.forEach(function (food) {
        ctx.fillStyle = 'blue';
        ctx.beginPath();
        ctx.arc(food.x, food.y, food.radius, 0, 2 * Math.PI);
        ctx.fill();
        ctx.fillStyle = 'white';
        ctx.beginPath();
        ctx.arc(food.x, food.y, food.radius * 0.9, 0, 2 * Math.PI);
        ctx.fill();
    });
    ctx.fillStyle = 'rgb(0, 255, 0)';
    ctx.beginPath();
    ctx.arc(home.x, home.y, home.radius, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = 'black';
    ctx.font = '6px monospace';
    ctx.fillText("".concat(collected), 2, 6);
    ctx.fillStyle = "rgba(0, 0, 0, ".concat(helpOpacity, ")");
    help.forEach(function (line, i) { return ctx.fillText(line, 2, 12 + i * 6); });
    if (helpOpacity > 0)
        helpOpacity -= (1 - helpOpacity + 1) / 500;
    ctx.restore();
    setTimeout(function () { return Render(ctx); }, 10);
};
var near = function (a, b, radius) {
    return Math.sqrt(Math.pow((a.x - b.x), 2) + Math.pow((a.y - b.y), 2)) < radius;
};
/** Moves an object and bounces it off the canvas bounds */
var move = function (vec, radius, pace) {
    vec.x += Math.cos(vec.direction) * speed * pace;
    vec.y += Math.sin(vec.direction) * speed * pace;
    if (vec.x < radius) {
        vec.x = radius;
        vec.direction = Math.PI - vec.direction;
    }
    else if (vec.x + radius > w()) {
        vec.x = w() - radius;
        vec.direction = Math.PI - vec.direction;
    }
    else if (vec.y < radius) {
        vec.y = radius;
        vec.direction = -vec.direction;
    }
    else if (vec.y + radius > h()) {
        vec.y = h() - radius;
        vec.direction = -vec.direction;
    }
};
var Update = function () {
    var updates = [];
    foods.forEach(function (food) { return move(food, food.radius, 0.1); });
    ants.forEach(function (ant) {
        move(ant, 1, ant.carrying ? 0.75 : 1);
        if (near(ant, home, home.radius) && ant.carrying) {
            ant.carrying = false;
            ant.home = 0;
            ant.direction += Math.PI;
            ++collected;
        }
        if (!ant.carrying) {
            foods.forEach(function (food) {
                if (!near(ant, food, food.radius))
                    return;
                ant.carrying = true;
                ant.food = 0;
                ant.direction += Math.PI;
                food.radius -= 0.001;
                if (food.radius < 1) {
                    food.x = Math.random() * w();
                    food.y = Math.random() * h();
                    food.radius = 4;
                    food.direction = Math.random() * Math.PI * 2;
                }
            });
        }
        ++ant.food;
        ++ant.home;
    });
    for (var i = 0; i < ants.length; ++i) {
        var a = ants[i];
        for (var j = i + 1; j < ants.length; ++j) {
            var b = ants[j];
            if (!near(a, b, screamRadius))
                continue;
            var fa = a.food + screamRadius;
            var ha = a.home + screamRadius;
            var fb = b.food + screamRadius;
            var hb = b.home + screamRadius;
            var updateFoodB = !b.carrying && fa < b.food;
            var updateHomeB = b.carrying && ha < b.home;
            var updateFoodA = !a.carrying && fb < a.food;
            var updateHomeA = a.carrying && hb < a.home;
            if (updateFoodB) {
                b.food = fa;
            }
            else if (updateHomeB) {
                b.home = ha;
            }
            if (updateFoodA) {
                a.food = fb;
            }
            else if (updateHomeA) {
                a.home = hb;
            }
            if (updateFoodB || updateHomeB) {
                var newDir = Math.atan2(a.y - b.y, a.x - b.x) + Math.random() * 0.5 - 0.25;
                b.direction = newDir;
                if (showUpdates) {
                    updates.push([a.x, a.y, b.x, b.y, updateFoodB]);
                }
            }
            else if (updateFoodA || updateHomeA) {
                var newDir = Math.atan2(b.y - a.y, b.x - a.x) + Math.random() * 0.5 - 0.25;
                a.direction = newDir;
                if (showUpdates) {
                    updates.push([a.x, a.y, b.x, b.y, updateFoodA]);
                }
            }
        }
    }
    return updates;
};


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/index.ts"]();
/******/ 	
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNBO1VBQ0E7VUFDQTtVQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3dhcm0vLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vc3dhcm0vd2VicGFjay9iZWZvcmUtc3RhcnR1cCIsIndlYnBhY2s6Ly9zd2FybS93ZWJwYWNrL3N0YXJ0dXAiLCJ3ZWJwYWNrOi8vc3dhcm0vd2VicGFjay9hZnRlci1zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbInR5cGUgVmVjID0geyB4OiBudW1iZXI7IHk6IG51bWJlciB9O1xyXG50eXBlIFZlYzMgPSBWZWMgJiB7IGRpcmVjdGlvbjogbnVtYmVyIH07XHJcbnR5cGUgQW50ID0gVmVjMyAmIHsgaG9tZTogbnVtYmVyOyBmb29kOiBudW1iZXI7IGNhcnJ5aW5nOiBib29sZWFuIH07XHJcbnR5cGUgRm9vZCA9IFZlYzMgJiB7IHJhZGl1czogbnVtYmVyIH07XHJcblxyXG5jb25zdCBoZWxwID0gW1xyXG4gICdDbGljayB0byB0b2dnbGUgdmlzaWJsZSB1cGRhdGVzJyxcclxuICAnc3BhY2ViYXIgdG8gbW92ZSBob21lIHRvIGN1cnNvcicsXHJcbl07XHJcbmNvbnN0IHNjYWxlID0gNjtcclxuY29uc3Qgc3BlZWQgPSAxO1xyXG5jb25zdCBzY3JlYW1SYWRpdXMgPSAxMjtcclxuY29uc3QgYW50czogQW50W10gPSBbXTtcclxuY29uc3QgZm9vZHM6IEZvb2RbXSA9IFtdO1xyXG5jb25zdCBuZXdIb21lID0geyB4OiAwLCB5OiAwIH07XHJcbmNvbnN0IGhvbWUgPSB7IHg6IDAsIHk6IDAsIHJhZGl1czogNCB9O1xyXG5sZXQgY29sbGVjdGVkID0gMDtcclxubGV0IHNob3dVcGRhdGVzID0gdHJ1ZTtcclxubGV0IGhlbHBPcGFjaXR5ID0gMTtcclxuY29uc3QgdyA9ICgpID0+IGRvY3VtZW50LmJvZHkub2Zmc2V0V2lkdGggLyBzY2FsZTtcclxuY29uc3QgaCA9ICgpID0+IGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0IC8gc2NhbGU7XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcclxuICBjb25zdCBjdHggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdjYW52YXMnKT8uZ2V0Q29udGV4dCgnMmQnKTtcclxuICBpZiAoIWN0eCkgcmV0dXJuO1xyXG4gIGN0eC5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZSA9PiB7XHJcbiAgICBuZXdIb21lLnggPSBlLm9mZnNldFggLyBzY2FsZTtcclxuICAgIG5ld0hvbWUueSA9IGUub2Zmc2V0WSAvIHNjYWxlO1xyXG4gIH0pO1xyXG4gIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZSA9PiB7XHJcbiAgICBzaG93VXBkYXRlcyA9ICFzaG93VXBkYXRlcztcclxuICB9KTtcclxuICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZSA9PiB7XHJcbiAgICBpZiAoZS5rZXkgPT09ICcgJykge1xyXG4gICAgICBob21lLnggPSBuZXdIb21lLng7XHJcbiAgICAgIGhvbWUueSA9IG5ld0hvbWUueTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgYW50cy5wdXNoKFxyXG4gICAgLi4ubmV3IEFycmF5KDQwMCkuZmlsbCgwKS5tYXAoKCkgPT4gKHtcclxuICAgICAgLi4ueyB4OiBNYXRoLnJhbmRvbSgpICogdygpLCB5OiBNYXRoLnJhbmRvbSgpICogaCgpIH0sXHJcbiAgICAgIC4uLnsgaG9tZTogMCwgZm9vZDogMCwgY2Fycnlpbmc6IGZhbHNlIH0sXHJcbiAgICAgIGRpcmVjdGlvbjogTWF0aC5yYW5kb20oKSAqIE1hdGguUEkgKiAyLFxyXG4gICAgfSkpXHJcbiAgKTtcclxuICBmb29kcy5wdXNoKFxyXG4gICAgLi4ubmV3IEFycmF5KDQpLmZpbGwoMCkubWFwKCgpID0+ICh7XHJcbiAgICAgIHg6IE1hdGgucmFuZG9tKCkgKiB3KCksXHJcbiAgICAgIHk6IE1hdGgucmFuZG9tKCkgKiBoKCksXHJcbiAgICAgIHJhZGl1czogNCxcclxuICAgICAgZGlyZWN0aW9uOiBNYXRoLnJhbmRvbSgpICogTWF0aC5QSSAqIDIsXHJcbiAgICB9KSlcclxuICApO1xyXG5cclxuICBob21lLnggPSAzMjtcclxuICBob21lLnkgPSBoKCkgLyAyO1xyXG5cclxuICBSZW5kZXIoY3R4KTtcclxufSk7XHJcblxyXG5jb25zdCBSZW5kZXIgPSAoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpID0+IHtcclxuICBjb25zdCB3aWR0aCA9IGRvY3VtZW50LmJvZHkub2Zmc2V0V2lkdGg7XHJcbiAgY29uc3QgaGVpZ2h0ID0gZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQ7XHJcbiAgY3R4LmNhbnZhcy5zdHlsZS53aWR0aCA9IGAkeyhjdHguY2FudmFzLndpZHRoID0gd2lkdGgpfWA7XHJcbiAgY3R4LmNhbnZhcy5zdHlsZS5oZWlnaHQgPSBgJHsoY3R4LmNhbnZhcy5oZWlnaHQgPSBoZWlnaHQpfWA7XHJcbiAgY3R4LmZpbGxTdHlsZSA9ICdyZ2JhKDEyOCwgMTI4LCAxMjgsIDEpJztcclxuICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XHJcblxyXG4gIGN0eC5zYXZlKCk7XHJcbiAgY3R4LnNjYWxlKHNjYWxlLCBzY2FsZSk7XHJcblxyXG4gIGNvbnN0IHVwZGF0ZXMgPSBVcGRhdGUoKTtcclxuICB1cGRhdGVzLmZvckVhY2goKFt4MSwgeTEsIHgyLCB5MiwgZm9vZF0pID0+IHtcclxuICAgIGN0eC5zdHJva2VTdHlsZSA9IGByZ2JhKDAsICR7Zm9vZCA/IDAgOiAyNTV9LCAke2Zvb2QgPyAyNTUgOiAwfSwgMC4xKWA7XHJcbiAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICBjdHgubW92ZVRvKHgxICsgMC41LCB5MSArIDAuNSk7XHJcbiAgICBjdHgubGluZVRvKHgyICsgMC41LCB5MiArIDAuNSk7XHJcbiAgICBjdHguc3Ryb2tlKCk7XHJcbiAgfSk7XHJcblxyXG4gIGFudHMuZm9yRWFjaChhbnQgPT4ge1xyXG4gICAgY3R4LmZpbGxTdHlsZSA9IGFudC5jYXJyeWluZyA/ICd3aGl0ZScgOiAnYmxhY2snO1xyXG4gICAgY3R4LmZpbGxSZWN0KGFudC54LCBhbnQueSwgMSwgMSk7XHJcbiAgfSk7XHJcbiAgZm9vZHMuZm9yRWFjaChmb29kID0+IHtcclxuICAgIGN0eC5maWxsU3R5bGUgPSAnYmx1ZSc7XHJcbiAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICBjdHguYXJjKGZvb2QueCwgZm9vZC55LCBmb29kLnJhZGl1cywgMCwgMiAqIE1hdGguUEkpO1xyXG4gICAgY3R4LmZpbGwoKTtcclxuICAgIGN0eC5maWxsU3R5bGUgPSAnd2hpdGUnO1xyXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgY3R4LmFyYyhmb29kLngsIGZvb2QueSwgZm9vZC5yYWRpdXMgKiAwLjksIDAsIDIgKiBNYXRoLlBJKTtcclxuICAgIGN0eC5maWxsKCk7XHJcbiAgfSk7XHJcblxyXG4gIGN0eC5maWxsU3R5bGUgPSAncmdiKDAsIDI1NSwgMCknO1xyXG4gIGN0eC5iZWdpblBhdGgoKTtcclxuICBjdHguYXJjKGhvbWUueCwgaG9tZS55LCBob21lLnJhZGl1cywgMCwgMiAqIE1hdGguUEkpO1xyXG4gIGN0eC5maWxsKCk7XHJcblxyXG4gIGN0eC5maWxsU3R5bGUgPSAnYmxhY2snO1xyXG4gIGN0eC5mb250ID0gJzZweCBtb25vc3BhY2UnO1xyXG4gIGN0eC5maWxsVGV4dChgJHtjb2xsZWN0ZWR9YCwgMiwgNik7XHJcbiAgY3R4LmZpbGxTdHlsZSA9IGByZ2JhKDAsIDAsIDAsICR7aGVscE9wYWNpdHl9KWA7XHJcbiAgaGVscC5mb3JFYWNoKChsaW5lLCBpKSA9PiBjdHguZmlsbFRleHQobGluZSwgMiwgMTIgKyBpICogNikpO1xyXG4gIGlmIChoZWxwT3BhY2l0eSA+IDApIGhlbHBPcGFjaXR5IC09ICgxIC0gaGVscE9wYWNpdHkgKyAxKSAvIDUwMDtcclxuXHJcbiAgY3R4LnJlc3RvcmUoKTtcclxuXHJcbiAgc2V0VGltZW91dCgoKSA9PiBSZW5kZXIoY3R4KSwgMTApO1xyXG59O1xyXG5cclxuY29uc3QgbmVhciA9IChhOiBWZWMsIGI6IFZlYywgcmFkaXVzOiBudW1iZXIpID0+XHJcbiAgTWF0aC5zcXJ0KChhLnggLSBiLngpICoqIDIgKyAoYS55IC0gYi55KSAqKiAyKSA8IHJhZGl1cztcclxuXHJcbi8qKiBNb3ZlcyBhbiBvYmplY3QgYW5kIGJvdW5jZXMgaXQgb2ZmIHRoZSBjYW52YXMgYm91bmRzICovXHJcbmNvbnN0IG1vdmUgPSAodmVjOiBWZWMzLCByYWRpdXM6IG51bWJlciwgcGFjZTogbnVtYmVyKSA9PiB7XHJcbiAgdmVjLnggKz0gTWF0aC5jb3ModmVjLmRpcmVjdGlvbikgKiBzcGVlZCAqIHBhY2U7XHJcbiAgdmVjLnkgKz0gTWF0aC5zaW4odmVjLmRpcmVjdGlvbikgKiBzcGVlZCAqIHBhY2U7XHJcblxyXG4gIGlmICh2ZWMueCA8IHJhZGl1cykge1xyXG4gICAgdmVjLnggPSByYWRpdXM7XHJcbiAgICB2ZWMuZGlyZWN0aW9uID0gTWF0aC5QSSAtIHZlYy5kaXJlY3Rpb247XHJcbiAgfSBlbHNlIGlmICh2ZWMueCArIHJhZGl1cyA+IHcoKSkge1xyXG4gICAgdmVjLnggPSB3KCkgLSByYWRpdXM7XHJcbiAgICB2ZWMuZGlyZWN0aW9uID0gTWF0aC5QSSAtIHZlYy5kaXJlY3Rpb247XHJcbiAgfSBlbHNlIGlmICh2ZWMueSA8IHJhZGl1cykge1xyXG4gICAgdmVjLnkgPSByYWRpdXM7XHJcbiAgICB2ZWMuZGlyZWN0aW9uID0gLXZlYy5kaXJlY3Rpb247XHJcbiAgfSBlbHNlIGlmICh2ZWMueSArIHJhZGl1cyA+IGgoKSkge1xyXG4gICAgdmVjLnkgPSBoKCkgLSByYWRpdXM7XHJcbiAgICB2ZWMuZGlyZWN0aW9uID0gLXZlYy5kaXJlY3Rpb247XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgVXBkYXRlID0gKCkgPT4ge1xyXG4gIGNvbnN0IHVwZGF0ZXM6IFtudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIGJvb2xlYW5dW10gPSBbXTtcclxuXHJcbiAgZm9vZHMuZm9yRWFjaChmb29kID0+IG1vdmUoZm9vZCwgZm9vZC5yYWRpdXMsIDAuMSkpO1xyXG5cclxuICBhbnRzLmZvckVhY2goYW50ID0+IHtcclxuICAgIG1vdmUoYW50LCAxLCBhbnQuY2FycnlpbmcgPyAwLjc1IDogMSk7XHJcblxyXG4gICAgaWYgKG5lYXIoYW50LCBob21lLCBob21lLnJhZGl1cykgJiYgYW50LmNhcnJ5aW5nKSB7XHJcbiAgICAgIGFudC5jYXJyeWluZyA9IGZhbHNlO1xyXG4gICAgICBhbnQuaG9tZSA9IDA7XHJcbiAgICAgIGFudC5kaXJlY3Rpb24gKz0gTWF0aC5QSTtcclxuICAgICAgKytjb2xsZWN0ZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFhbnQuY2FycnlpbmcpIHtcclxuICAgICAgZm9vZHMuZm9yRWFjaChmb29kID0+IHtcclxuICAgICAgICBpZiAoIW5lYXIoYW50LCBmb29kLCBmb29kLnJhZGl1cykpIHJldHVybjtcclxuICAgICAgICBhbnQuY2FycnlpbmcgPSB0cnVlO1xyXG4gICAgICAgIGFudC5mb29kID0gMDtcclxuICAgICAgICBhbnQuZGlyZWN0aW9uICs9IE1hdGguUEk7XHJcbiAgICAgICAgZm9vZC5yYWRpdXMgLT0gMC4wMDE7XHJcbiAgICAgICAgaWYgKGZvb2QucmFkaXVzIDwgMSkge1xyXG4gICAgICAgICAgZm9vZC54ID0gTWF0aC5yYW5kb20oKSAqIHcoKTtcclxuICAgICAgICAgIGZvb2QueSA9IE1hdGgucmFuZG9tKCkgKiBoKCk7XHJcbiAgICAgICAgICBmb29kLnJhZGl1cyA9IDQ7XHJcbiAgICAgICAgICBmb29kLmRpcmVjdGlvbiA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJICogMjtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgICsrYW50LmZvb2Q7XHJcbiAgICArK2FudC5ob21lO1xyXG4gIH0pO1xyXG5cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IGFudHMubGVuZ3RoOyArK2kpIHtcclxuICAgIGNvbnN0IGEgPSBhbnRzW2ldITtcclxuICAgIGZvciAobGV0IGogPSBpICsgMTsgaiA8IGFudHMubGVuZ3RoOyArK2opIHtcclxuICAgICAgY29uc3QgYiA9IGFudHNbal0hO1xyXG4gICAgICBpZiAoIW5lYXIoYSwgYiwgc2NyZWFtUmFkaXVzKSkgY29udGludWU7XHJcbiAgICAgIGNvbnN0IGZhID0gYS5mb29kICsgc2NyZWFtUmFkaXVzO1xyXG4gICAgICBjb25zdCBoYSA9IGEuaG9tZSArIHNjcmVhbVJhZGl1cztcclxuICAgICAgY29uc3QgZmIgPSBiLmZvb2QgKyBzY3JlYW1SYWRpdXM7XHJcbiAgICAgIGNvbnN0IGhiID0gYi5ob21lICsgc2NyZWFtUmFkaXVzO1xyXG4gICAgICBjb25zdCB1cGRhdGVGb29kQiA9ICFiLmNhcnJ5aW5nICYmIGZhIDwgYi5mb29kO1xyXG4gICAgICBjb25zdCB1cGRhdGVIb21lQiA9IGIuY2FycnlpbmcgJiYgaGEgPCBiLmhvbWU7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZUZvb2RBID0gIWEuY2FycnlpbmcgJiYgZmIgPCBhLmZvb2Q7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZUhvbWVBID0gYS5jYXJyeWluZyAmJiBoYiA8IGEuaG9tZTtcclxuICAgICAgaWYgKHVwZGF0ZUZvb2RCKSB7XHJcbiAgICAgICAgYi5mb29kID0gZmE7XHJcbiAgICAgIH0gZWxzZSBpZiAodXBkYXRlSG9tZUIpIHtcclxuICAgICAgICBiLmhvbWUgPSBoYTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodXBkYXRlRm9vZEEpIHtcclxuICAgICAgICBhLmZvb2QgPSBmYjtcclxuICAgICAgfSBlbHNlIGlmICh1cGRhdGVIb21lQSkge1xyXG4gICAgICAgIGEuaG9tZSA9IGhiO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh1cGRhdGVGb29kQiB8fCB1cGRhdGVIb21lQikge1xyXG4gICAgICAgIGNvbnN0IG5ld0RpciA9XHJcbiAgICAgICAgICBNYXRoLmF0YW4yKGEueSAtIGIueSwgYS54IC0gYi54KSArIE1hdGgucmFuZG9tKCkgKiAwLjUgLSAwLjI1O1xyXG4gICAgICAgIGIuZGlyZWN0aW9uID0gbmV3RGlyO1xyXG4gICAgICAgIGlmIChzaG93VXBkYXRlcykge1xyXG4gICAgICAgICAgdXBkYXRlcy5wdXNoKFthLngsIGEueSwgYi54LCBiLnksIHVwZGF0ZUZvb2RCXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKHVwZGF0ZUZvb2RBIHx8IHVwZGF0ZUhvbWVBKSB7XHJcbiAgICAgICAgY29uc3QgbmV3RGlyID1cclxuICAgICAgICAgIE1hdGguYXRhbjIoYi55IC0gYS55LCBiLnggLSBhLngpICsgTWF0aC5yYW5kb20oKSAqIDAuNSAtIDAuMjU7XHJcbiAgICAgICAgYS5kaXJlY3Rpb24gPSBuZXdEaXI7XHJcbiAgICAgICAgaWYgKHNob3dVcGRhdGVzKSB7XHJcbiAgICAgICAgICB1cGRhdGVzLnB1c2goW2EueCwgYS55LCBiLngsIGIueSwgdXBkYXRlRm9vZEFdKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiB1cGRhdGVzO1xyXG59O1xyXG4iLCIiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IHt9O1xuX193ZWJwYWNrX21vZHVsZXNfX1tcIi4vc3JjL2luZGV4LnRzXCJdKCk7XG4iLCIiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=