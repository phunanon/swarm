/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/***/ (function() {


var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var scale = 6;
var speed = 1;
var screamRadius = 16;
var ants = [];
var foods = [];
var walls = [];
var newHome = { x: 0, y: 0 };
var home = { x: 0, y: 0, radius: 4 };
var collected = 0;
var w = function () { return document.body.offsetWidth / scale; };
var h = function () { return document.body.offsetHeight / scale; };
window.addEventListener('DOMContentLoaded', function () {
    var _a;
    var ctx = (_a = document.querySelector('canvas')) === null || _a === void 0 ? void 0 : _a.getContext('2d');
    if (!ctx)
        return;
    ctx.canvas.addEventListener('mousemove', function (e) {
        newHome.x = e.offsetX / scale;
        newHome.y = e.offsetY / scale;
    });
    document.body.addEventListener('keyup', function (e) {
        if (e.key === ' ') {
            home.x = newHome.x;
            home.y = newHome.y;
        }
    });
    ants.push.apply(ants, new Array(512).fill(0).map(function () { return (__assign(__assign({ x: Math.random() * w(), y: Math.random() * h() }, { home: 0, food: 0, carrying: false }), { direction: Math.random() * Math.PI * 2 })); }));
    foods.push.apply(foods, new Array(3).fill(0).map(function () { return ({
        x: Math.random() * w(),
        y: Math.random() * h(),
        radius: 4,
        direction: Math.random() * Math.PI * 2,
    }); }));
    walls.push.apply(walls, new Array(8).fill(0).map(function () {
        var _a = [Math.random() * w(), Math.random() * h()], x = _a[0], y = _a[1];
        var horizontal = Math.random() > 0.5;
        return {
            a: { x: x, y: y },
            b: {
                x: x + 4 + Math.random() * (horizontal ? 64 : 0),
                y: y + 4 + Math.random() * (horizontal ? 0 : 64),
            },
        };
    }));
    home.x = 32;
    home.y = h() / 2;
    Render(ctx);
});
var Render = function (ctx) {
    var width = document.body.offsetWidth;
    var height = document.body.offsetHeight;
    ctx.canvas.style.width = "".concat((ctx.canvas.width = width));
    ctx.canvas.style.height = "".concat((ctx.canvas.height = height));
    ctx.fillStyle = 'rgba(255, 255, 255, 0.25)';
    ctx.fillRect(0, 0, width, height);
    ctx.save();
    ctx.scale(scale, scale);
    ants.forEach(function (ant) {
        ctx.fillStyle = ant.carrying ? 'red' : 'black';
        ctx.fillRect(ant.x, ant.y, 1, 1);
    });
    ctx.fillStyle = 'blue';
    foods.forEach(function (food) {
        ctx.beginPath();
        ctx.arc(food.x, food.y, food.radius, 0, 2 * Math.PI);
        ctx.fill();
    });
    ctx.fillStyle = 'black';
    walls.forEach(function (wall) {
        ctx.fillRect(wall.a.x, wall.a.y, wall.b.x - wall.a.x, wall.b.y - wall.a.y);
    });
    ctx.fillStyle = 'green';
    ctx.beginPath();
    ctx.arc(home.x, home.y, home.radius, 0, 2 * Math.PI);
    ctx.fill();
    var updates = Update();
    updates.forEach(function (_a) {
        var x1 = _a[0], y1 = _a[1], x2 = _a[2], y2 = _a[3], food = _a[4], home = _a[5];
        ctx.strokeStyle = "rgba(".concat(food && home ? 128 : 0, ", ").concat(food && !home ? 0 : 128, ", ").concat(food && !home ? 128 : 0, ", 0.05)");
        ctx.beginPath();
        ctx.moveTo(x1 + 0.5, y1 + 0.5);
        ctx.lineTo(x2 + 0.5, y2 + 0.5);
        ctx.stroke();
    });
    ctx.fillStyle = 'black';
    ctx.font = '8px monospace';
    ctx.fillText("Collected ".concat(collected), 2, 8);
    ctx.restore();
    setTimeout(function () { return Render(ctx); }, 10);
};
var near = function (a, b, radius) {
    return a.x > b.x - radius &&
        a.x < b.x + radius &&
        a.y > b.y - radius &&
        a.y < b.y + radius;
};
/** Moves an object and bounces it off the canvas bounds */
var move = function (vec, radius, speedMult) {
    if (radius === void 0) { radius = 0; }
    if (speedMult === void 0) { speedMult = 1; }
    vec.x += Math.cos(vec.direction) * speed * speedMult;
    vec.y += Math.sin(vec.direction) * speed * speedMult;
    if (vec.x < radius) {
        vec.x = radius;
        vec.direction = Math.PI - vec.direction;
    }
    if (vec.x + radius > w()) {
        vec.x = w() - radius;
        vec.direction = Math.PI - vec.direction;
    }
    if (vec.y < radius) {
        vec.y = radius;
        vec.direction = -vec.direction;
    }
    if (vec.y + radius > h()) {
        vec.y = h() - radius;
        vec.direction = -vec.direction;
    }
};
var Update = function () {
    var updates = [];
    foods.forEach(function (food) { return move(food, food.radius, 0.2); });
    ants.forEach(function (ant) {
        move(ant);
        walls.forEach(function (wall) {
            var inX = ant.x > wall.a.x && ant.x < wall.b.x;
            var x0d = inX ? ant.x - wall.a.x : 0;
            var x1d = inX ? wall.b.x - ant.x : 0;
            var inY = ant.y > wall.a.y && ant.y < wall.b.y;
            var y0d = inY ? ant.y - wall.a.y : 0;
            var y1d = inY ? wall.b.y - ant.y : 0;
            if (inX && inY) {
                //Check if hit top or bottom sides
                if (Math.min(y0d, y1d) < Math.min(x0d, x1d)) {
                    ant.direction = -ant.direction;
                }
                else {
                    ant.direction = Math.PI - ant.direction;
                }
                move(ant);
            }
        });
        if (near(ant, home, home.radius) && ant.carrying) {
            ant.carrying = false;
            ant.home = 0;
            ant.direction += Math.PI;
            ++collected;
        }
        if (!ant.carrying) {
            foods.forEach(function (food) {
                if (near(ant, food, food.radius)) {
                    ant.carrying = true;
                    ant.food = 0;
                    ant.direction += Math.PI;
                    food.radius -= 0.001;
                    if (food.radius < 1) {
                        food.x = Math.random() * w();
                        food.y = Math.random() * h();
                        food.radius = 4;
                        food.direction = Math.random() * Math.PI * 2;
                    }
                }
            });
        }
        ++ant.food;
        ++ant.home;
    });
    ants.forEach(function (ant) {
        ants.forEach(function (other) {
            if (ant === other)
                return;
            if (!near(ant, other, screamRadius))
                return;
            var f = ant.food + screamRadius;
            var h = ant.home + screamRadius;
            var closerFood = f < other.food;
            var closerHome = h < other.home;
            var goFood = !other.carrying && closerFood;
            var goHome = other.carrying && closerHome;
            var newDir = Math.atan2(ant.y - other.y, ant.x - other.x) +
                Math.random() * 0.5 -
                0.25;
            if (closerFood) {
                other.food = f;
            }
            else if (closerHome) {
                other.home = h;
            }
            if (closerFood || closerHome) {
                updates.push([ant.x, ant.y, other.x, other.y, closerFood, closerHome]);
            }
            if (goFood || goHome) {
                other.direction = newDir;
            }
        });
    });
    return updates;
};


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/index.ts"]();
/******/ 	
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU1BLElBQU0sS0FBSyxHQUFHLENBQUMsQ0FBQztBQUNoQixJQUFNLEtBQUssR0FBRyxDQUFDLENBQUM7QUFDaEIsSUFBTSxZQUFZLEdBQUcsRUFBRSxDQUFDO0FBQ3hCLElBQU0sSUFBSSxHQUFVLEVBQUUsQ0FBQztBQUN2QixJQUFNLEtBQUssR0FBVyxFQUFFLENBQUM7QUFDekIsSUFBTSxLQUFLLEdBQVcsRUFBRSxDQUFDO0FBQ3pCLElBQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7QUFDL0IsSUFBTSxJQUFJLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDO0FBQ3ZDLElBQUksU0FBUyxHQUFHLENBQUMsQ0FBQztBQUNsQixJQUFNLENBQUMsR0FBRyxjQUFNLGVBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssRUFBakMsQ0FBaUMsQ0FBQztBQUNsRCxJQUFNLENBQUMsR0FBRyxjQUFNLGVBQVEsQ0FBQyxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssRUFBbEMsQ0FBa0MsQ0FBQztBQUVuRCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUU7O0lBQzFDLElBQU0sR0FBRyxHQUFHLGNBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLDBDQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMvRCxJQUFJLENBQUMsR0FBRztRQUFFLE9BQU87SUFDakIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsV0FBQztRQUN4QyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO1FBQzlCLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7SUFDaEMsQ0FBQyxDQUFDLENBQUM7SUFDSCxRQUFRLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxXQUFDO1FBQ3ZDLElBQUksQ0FBQyxDQUFDLEdBQUcsS0FBSyxHQUFHLEVBQUU7WUFDakIsSUFBSSxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ25CLElBQUksQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQztTQUNwQjtJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLElBQUksT0FBVCxJQUFJLEVBQ0MsSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxjQUFNLDBCQUMvQixFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUNsRCxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEtBQ3hDLFNBQVMsRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLElBQ3RDLEVBSmtDLENBSWxDLENBQUMsRUFDSDtJQUNGLEtBQUssQ0FBQyxJQUFJLE9BQVYsS0FBSyxFQUNBLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsY0FBTSxRQUFDO1FBQ2pDLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxFQUFFO1FBQ3RCLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxFQUFFO1FBQ3RCLE1BQU0sRUFBRSxDQUFDO1FBQ1QsU0FBUyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUM7S0FDdkMsQ0FBQyxFQUxnQyxDQUtoQyxDQUFDLEVBQ0g7SUFDRixLQUFLLENBQUMsSUFBSSxPQUFWLEtBQUssRUFDQSxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQ3BCLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQWxELENBQUMsVUFBRSxDQUFDLFFBQThDLENBQUM7UUFDMUQsSUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQztRQUN2QyxPQUFPO1lBQ0wsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxLQUFFLENBQUMsS0FBRTtZQUNYLENBQUMsRUFBRTtnQkFDRCxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNoRCxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO2FBQ2pEO1NBQ0YsQ0FBQztJQUNKLENBQUMsQ0FBQyxFQUNGO0lBRUYsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDWixJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUVqQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDZCxDQUFDLENBQUMsQ0FBQztBQUVILElBQU0sTUFBTSxHQUFHLFVBQUMsR0FBNkI7SUFDM0MsSUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDeEMsSUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUM7SUFDMUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLFVBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBRSxDQUFDO0lBQ3pELEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxVQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLENBQUUsQ0FBQztJQUM1RCxHQUFHLENBQUMsU0FBUyxHQUFHLDJCQUEyQixDQUFDO0lBQzVDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFFbEMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ1gsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFFeEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFHO1FBQ2QsR0FBRyxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUMvQyxHQUFHLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDSCxHQUFHLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQztJQUN2QixLQUFLLENBQUMsT0FBTyxDQUFDLGNBQUk7UUFDaEIsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDckQsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2IsQ0FBQyxDQUFDLENBQUM7SUFDSCxHQUFHLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQztJQUN4QixLQUFLLENBQUMsT0FBTyxDQUFDLGNBQUk7UUFDaEIsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzdFLENBQUMsQ0FBQyxDQUFDO0lBRUgsR0FBRyxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUM7SUFDeEIsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ2hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDckQsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0lBRVgsSUFBTSxPQUFPLEdBQUcsTUFBTSxFQUFFLENBQUM7SUFDekIsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFDLEVBQTRCO1lBQTNCLEVBQUUsVUFBRSxFQUFFLFVBQUUsRUFBRSxVQUFFLEVBQUUsVUFBRSxJQUFJLFVBQUUsSUFBSTtRQUMxQyxHQUFHLENBQUMsV0FBVyxHQUFHLGVBQVEsSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLGVBQzlDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLGVBQ3BCLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVMsQ0FBQztRQUN0QyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDaEIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEdBQUcsR0FBRyxFQUFFLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQztRQUMvQixHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsR0FBRyxHQUFHLEVBQUUsRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQy9CLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNmLENBQUMsQ0FBQyxDQUFDO0lBRUgsR0FBRyxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUM7SUFDeEIsR0FBRyxDQUFDLElBQUksR0FBRyxlQUFlLENBQUM7SUFDM0IsR0FBRyxDQUFDLFFBQVEsQ0FBQyxvQkFBYSxTQUFTLENBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFFN0MsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBRWQsVUFBVSxDQUFDLGNBQU0sYUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFYLENBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUNwQyxDQUFDLENBQUM7QUFFRixJQUFNLElBQUksR0FBRyxVQUFDLENBQU0sRUFBRSxDQUFNLEVBQUUsTUFBYztJQUMxQyxRQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTTtRQUNsQixDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTTtRQUNsQixDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTTtRQUNsQixDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTTtBQUhsQixDQUdrQixDQUFDO0FBRXJCLDJEQUEyRDtBQUMzRCxJQUFNLElBQUksR0FBRyxVQUFDLEdBQVMsRUFBRSxNQUFVLEVBQUUsU0FBYTtJQUF6QixtQ0FBVTtJQUFFLHlDQUFhO0lBQ2hELEdBQUcsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxHQUFHLFNBQVMsQ0FBQztJQUNyRCxHQUFHLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEtBQUssR0FBRyxTQUFTLENBQUM7SUFFckQsSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLE1BQU0sRUFBRTtRQUNsQixHQUFHLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQztRQUNmLEdBQUcsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDO0tBQ3pDO0lBQ0QsSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLE1BQU0sR0FBRyxDQUFDLEVBQUUsRUFBRTtRQUN4QixHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLE1BQU0sQ0FBQztRQUNyQixHQUFHLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQztLQUN6QztJQUNELElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxNQUFNLEVBQUU7UUFDbEIsR0FBRyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUM7UUFDZixHQUFHLENBQUMsU0FBUyxHQUFHLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQztLQUNoQztJQUNELElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxNQUFNLEdBQUcsQ0FBQyxFQUFFLEVBQUU7UUFDeEIsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxNQUFNLENBQUM7UUFDckIsR0FBRyxDQUFDLFNBQVMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUM7S0FDaEM7QUFDSCxDQUFDLENBQUM7QUFFRixJQUFNLE1BQU0sR0FBRztJQUNiLElBQU0sT0FBTyxHQUF5RCxFQUFFLENBQUM7SUFFekUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxjQUFJLElBQUksV0FBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxFQUE1QixDQUE0QixDQUFDLENBQUM7SUFFcEQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFHO1FBQ2QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRVYsS0FBSyxDQUFDLE9BQU8sQ0FBQyxjQUFJO1lBQ2hCLElBQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqRCxJQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2QyxJQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2QyxJQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDakQsSUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkMsSUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkMsSUFBSSxHQUFHLElBQUksR0FBRyxFQUFFO2dCQUNkLGtDQUFrQztnQkFDbEMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRTtvQkFDM0MsR0FBRyxDQUFDLFNBQVMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUM7aUJBQ2hDO3FCQUFNO29CQUNMLEdBQUcsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDO2lCQUN6QztnQkFDRCxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDWDtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksR0FBRyxDQUFDLFFBQVEsRUFBRTtZQUNoRCxHQUFHLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztZQUNyQixHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztZQUNiLEdBQUcsQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUN6QixFQUFFLFNBQVMsQ0FBQztTQUNiO1FBRUQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUU7WUFDakIsS0FBSyxDQUFDLE9BQU8sQ0FBQyxjQUFJO2dCQUNoQixJQUFJLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRTtvQkFDaEMsR0FBRyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7b0JBQ3BCLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO29CQUNiLEdBQUcsQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQztvQkFDekIsSUFBSSxDQUFDLE1BQU0sSUFBSSxLQUFLLENBQUM7b0JBQ3JCLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7d0JBQ25CLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDO3dCQUM3QixJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQzt3QkFDN0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7d0JBQ2hCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO3FCQUM5QztpQkFDRjtZQUNILENBQUMsQ0FBQyxDQUFDO1NBQ0o7UUFFRCxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUM7UUFDWCxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFDYixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxPQUFPLENBQUMsYUFBRztRQUNkLElBQUksQ0FBQyxPQUFPLENBQUMsZUFBSztZQUNoQixJQUFJLEdBQUcsS0FBSyxLQUFLO2dCQUFFLE9BQU87WUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLFlBQVksQ0FBQztnQkFBRSxPQUFPO1lBQzVDLElBQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxJQUFJLEdBQUcsWUFBWSxDQUFDO1lBQ2xDLElBQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxJQUFJLEdBQUcsWUFBWSxDQUFDO1lBQ2xDLElBQU0sVUFBVSxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDO1lBQ2xDLElBQU0sVUFBVSxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDO1lBQ2xDLElBQU0sTUFBTSxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVEsSUFBSSxVQUFVLENBQUM7WUFDN0MsSUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLFFBQVEsSUFBSSxVQUFVLENBQUM7WUFDNUMsSUFBTSxNQUFNLEdBQ1YsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUM1QyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsR0FBRztnQkFDbkIsSUFBSSxDQUFDO1lBQ1AsSUFBSSxVQUFVLEVBQUU7Z0JBQ2QsS0FBSyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7YUFDaEI7aUJBQU0sSUFBSSxVQUFVLEVBQUU7Z0JBQ3JCLEtBQUssQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO2FBQ2hCO1lBQ0QsSUFBSSxVQUFVLElBQUksVUFBVSxFQUFFO2dCQUM1QixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsRUFBRSxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQzthQUN4RTtZQUNELElBQUksTUFBTSxJQUFJLE1BQU0sRUFBRTtnQkFDcEIsS0FBSyxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUM7YUFDMUI7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxPQUFPLENBQUM7QUFDakIsQ0FBQyxDQUFDOzs7Ozs7OztVRXRPRjtVQUNBO1VBQ0E7VUFDQTtVQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3dhcm0vLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vc3dhcm0vd2VicGFjay9iZWZvcmUtc3RhcnR1cCIsIndlYnBhY2s6Ly9zd2FybS93ZWJwYWNrL3N0YXJ0dXAiLCJ3ZWJwYWNrOi8vc3dhcm0vd2VicGFjay9hZnRlci1zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbInR5cGUgVmVjID0geyB4OiBudW1iZXI7IHk6IG51bWJlciB9O1xyXG50eXBlIFZlYzMgPSBWZWMgJiB7IGRpcmVjdGlvbjogbnVtYmVyIH07XHJcbnR5cGUgQW50ID0gVmVjMyAmIHsgaG9tZTogbnVtYmVyOyBmb29kOiBudW1iZXI7IGNhcnJ5aW5nOiBib29sZWFuIH07XHJcbnR5cGUgRm9vZCA9IFZlYzMgJiB7IHJhZGl1czogbnVtYmVyIH07XHJcbnR5cGUgV2FsbCA9IHsgYTogVmVjOyBiOiBWZWMgfTtcclxuXHJcbmNvbnN0IHNjYWxlID0gNjtcclxuY29uc3Qgc3BlZWQgPSAxO1xyXG5jb25zdCBzY3JlYW1SYWRpdXMgPSAxNjtcclxuY29uc3QgYW50czogQW50W10gPSBbXTtcclxuY29uc3QgZm9vZHM6IEZvb2RbXSA9IFtdO1xyXG5jb25zdCB3YWxsczogV2FsbFtdID0gW107XHJcbmNvbnN0IG5ld0hvbWUgPSB7IHg6IDAsIHk6IDAgfTtcclxuY29uc3QgaG9tZSA9IHsgeDogMCwgeTogMCwgcmFkaXVzOiA0IH07XHJcbmxldCBjb2xsZWN0ZWQgPSAwO1xyXG5jb25zdCB3ID0gKCkgPT4gZG9jdW1lbnQuYm9keS5vZmZzZXRXaWR0aCAvIHNjYWxlO1xyXG5jb25zdCBoID0gKCkgPT4gZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQgLyBzY2FsZTtcclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4ge1xyXG4gIGNvbnN0IGN0eCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2NhbnZhcycpPy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gIGlmICghY3R4KSByZXR1cm47XHJcbiAgY3R4LmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBlID0+IHtcclxuICAgIG5ld0hvbWUueCA9IGUub2Zmc2V0WCAvIHNjYWxlO1xyXG4gICAgbmV3SG9tZS55ID0gZS5vZmZzZXRZIC8gc2NhbGU7XHJcbiAgfSk7XHJcbiAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGUgPT4ge1xyXG4gICAgaWYgKGUua2V5ID09PSAnICcpIHtcclxuICAgICAgaG9tZS54ID0gbmV3SG9tZS54O1xyXG4gICAgICBob21lLnkgPSBuZXdIb21lLnk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIGFudHMucHVzaChcclxuICAgIC4uLm5ldyBBcnJheSg1MTIpLmZpbGwoMCkubWFwKCgpID0+ICh7XHJcbiAgICAgIC4uLnsgeDogTWF0aC5yYW5kb20oKSAqIHcoKSwgeTogTWF0aC5yYW5kb20oKSAqIGgoKSB9LFxyXG4gICAgICAuLi57IGhvbWU6IDAsIGZvb2Q6IDAsIGNhcnJ5aW5nOiBmYWxzZSB9LFxyXG4gICAgICBkaXJlY3Rpb246IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJICogMixcclxuICAgIH0pKVxyXG4gICk7XHJcbiAgZm9vZHMucHVzaChcclxuICAgIC4uLm5ldyBBcnJheSgzKS5maWxsKDApLm1hcCgoKSA9PiAoe1xyXG4gICAgICB4OiBNYXRoLnJhbmRvbSgpICogdygpLFxyXG4gICAgICB5OiBNYXRoLnJhbmRvbSgpICogaCgpLFxyXG4gICAgICByYWRpdXM6IDQsXHJcbiAgICAgIGRpcmVjdGlvbjogTWF0aC5yYW5kb20oKSAqIE1hdGguUEkgKiAyLFxyXG4gICAgfSkpXHJcbiAgKTtcclxuICB3YWxscy5wdXNoKFxyXG4gICAgLi4ubmV3IEFycmF5KDgpLmZpbGwoMCkubWFwKCgpID0+IHtcclxuICAgICAgY29uc3QgW3gsIHldID0gW01hdGgucmFuZG9tKCkgKiB3KCksIE1hdGgucmFuZG9tKCkgKiBoKCldO1xyXG4gICAgICBjb25zdCBob3Jpem9udGFsID0gTWF0aC5yYW5kb20oKSA+IDAuNTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBhOiB7IHgsIHkgfSxcclxuICAgICAgICBiOiB7XHJcbiAgICAgICAgICB4OiB4ICsgNCArIE1hdGgucmFuZG9tKCkgKiAoaG9yaXpvbnRhbCA/IDY0IDogMCksXHJcbiAgICAgICAgICB5OiB5ICsgNCArIE1hdGgucmFuZG9tKCkgKiAoaG9yaXpvbnRhbCA/IDAgOiA2NCksXHJcbiAgICAgICAgfSxcclxuICAgICAgfTtcclxuICAgIH0pXHJcbiAgKTtcclxuXHJcbiAgaG9tZS54ID0gMzI7XHJcbiAgaG9tZS55ID0gaCgpIC8gMjtcclxuXHJcbiAgUmVuZGVyKGN0eCk7XHJcbn0pO1xyXG5cclxuY29uc3QgUmVuZGVyID0gKGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKSA9PiB7XHJcbiAgY29uc3Qgd2lkdGggPSBkb2N1bWVudC5ib2R5Lm9mZnNldFdpZHRoO1xyXG4gIGNvbnN0IGhlaWdodCA9IGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0O1xyXG4gIGN0eC5jYW52YXMuc3R5bGUud2lkdGggPSBgJHsoY3R4LmNhbnZhcy53aWR0aCA9IHdpZHRoKX1gO1xyXG4gIGN0eC5jYW52YXMuc3R5bGUuaGVpZ2h0ID0gYCR7KGN0eC5jYW52YXMuaGVpZ2h0ID0gaGVpZ2h0KX1gO1xyXG4gIGN0eC5maWxsU3R5bGUgPSAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjI1KSc7XHJcbiAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xyXG5cclxuICBjdHguc2F2ZSgpO1xyXG4gIGN0eC5zY2FsZShzY2FsZSwgc2NhbGUpO1xyXG5cclxuICBhbnRzLmZvckVhY2goYW50ID0+IHtcclxuICAgIGN0eC5maWxsU3R5bGUgPSBhbnQuY2FycnlpbmcgPyAncmVkJyA6ICdibGFjayc7XHJcbiAgICBjdHguZmlsbFJlY3QoYW50LngsIGFudC55LCAxLCAxKTtcclxuICB9KTtcclxuICBjdHguZmlsbFN0eWxlID0gJ2JsdWUnO1xyXG4gIGZvb2RzLmZvckVhY2goZm9vZCA9PiB7XHJcbiAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICBjdHguYXJjKGZvb2QueCwgZm9vZC55LCBmb29kLnJhZGl1cywgMCwgMiAqIE1hdGguUEkpO1xyXG4gICAgY3R4LmZpbGwoKTtcclxuICB9KTtcclxuICBjdHguZmlsbFN0eWxlID0gJ2JsYWNrJztcclxuICB3YWxscy5mb3JFYWNoKHdhbGwgPT4ge1xyXG4gICAgY3R4LmZpbGxSZWN0KHdhbGwuYS54LCB3YWxsLmEueSwgd2FsbC5iLnggLSB3YWxsLmEueCwgd2FsbC5iLnkgLSB3YWxsLmEueSk7XHJcbiAgfSk7XHJcblxyXG4gIGN0eC5maWxsU3R5bGUgPSAnZ3JlZW4nO1xyXG4gIGN0eC5iZWdpblBhdGgoKTtcclxuICBjdHguYXJjKGhvbWUueCwgaG9tZS55LCBob21lLnJhZGl1cywgMCwgMiAqIE1hdGguUEkpO1xyXG4gIGN0eC5maWxsKCk7XHJcblxyXG4gIGNvbnN0IHVwZGF0ZXMgPSBVcGRhdGUoKTtcclxuICB1cGRhdGVzLmZvckVhY2goKFt4MSwgeTEsIHgyLCB5MiwgZm9vZCwgaG9tZV0pID0+IHtcclxuICAgIGN0eC5zdHJva2VTdHlsZSA9IGByZ2JhKCR7Zm9vZCAmJiBob21lID8gMTI4IDogMH0sICR7XHJcbiAgICAgIGZvb2QgJiYgIWhvbWUgPyAwIDogMTI4XHJcbiAgICB9LCAke2Zvb2QgJiYgIWhvbWUgPyAxMjggOiAwfSwgMC4wNSlgO1xyXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgY3R4Lm1vdmVUbyh4MSArIDAuNSwgeTEgKyAwLjUpO1xyXG4gICAgY3R4LmxpbmVUbyh4MiArIDAuNSwgeTIgKyAwLjUpO1xyXG4gICAgY3R4LnN0cm9rZSgpO1xyXG4gIH0pO1xyXG5cclxuICBjdHguZmlsbFN0eWxlID0gJ2JsYWNrJztcclxuICBjdHguZm9udCA9ICc4cHggbW9ub3NwYWNlJztcclxuICBjdHguZmlsbFRleHQoYENvbGxlY3RlZCAke2NvbGxlY3RlZH1gLCAyLCA4KTtcclxuXHJcbiAgY3R4LnJlc3RvcmUoKTtcclxuXHJcbiAgc2V0VGltZW91dCgoKSA9PiBSZW5kZXIoY3R4KSwgMTApO1xyXG59O1xyXG5cclxuY29uc3QgbmVhciA9IChhOiBWZWMsIGI6IFZlYywgcmFkaXVzOiBudW1iZXIpID0+XHJcbiAgYS54ID4gYi54IC0gcmFkaXVzICYmXHJcbiAgYS54IDwgYi54ICsgcmFkaXVzICYmXHJcbiAgYS55ID4gYi55IC0gcmFkaXVzICYmXHJcbiAgYS55IDwgYi55ICsgcmFkaXVzO1xyXG5cclxuLyoqIE1vdmVzIGFuIG9iamVjdCBhbmQgYm91bmNlcyBpdCBvZmYgdGhlIGNhbnZhcyBib3VuZHMgKi9cclxuY29uc3QgbW92ZSA9ICh2ZWM6IFZlYzMsIHJhZGl1cyA9IDAsIHNwZWVkTXVsdCA9IDEpID0+IHtcclxuICB2ZWMueCArPSBNYXRoLmNvcyh2ZWMuZGlyZWN0aW9uKSAqIHNwZWVkICogc3BlZWRNdWx0O1xyXG4gIHZlYy55ICs9IE1hdGguc2luKHZlYy5kaXJlY3Rpb24pICogc3BlZWQgKiBzcGVlZE11bHQ7XHJcblxyXG4gIGlmICh2ZWMueCA8IHJhZGl1cykge1xyXG4gICAgdmVjLnggPSByYWRpdXM7XHJcbiAgICB2ZWMuZGlyZWN0aW9uID0gTWF0aC5QSSAtIHZlYy5kaXJlY3Rpb247XHJcbiAgfVxyXG4gIGlmICh2ZWMueCArIHJhZGl1cyA+IHcoKSkge1xyXG4gICAgdmVjLnggPSB3KCkgLSByYWRpdXM7XHJcbiAgICB2ZWMuZGlyZWN0aW9uID0gTWF0aC5QSSAtIHZlYy5kaXJlY3Rpb247XHJcbiAgfVxyXG4gIGlmICh2ZWMueSA8IHJhZGl1cykge1xyXG4gICAgdmVjLnkgPSByYWRpdXM7XHJcbiAgICB2ZWMuZGlyZWN0aW9uID0gLXZlYy5kaXJlY3Rpb247XHJcbiAgfVxyXG4gIGlmICh2ZWMueSArIHJhZGl1cyA+IGgoKSkge1xyXG4gICAgdmVjLnkgPSBoKCkgLSByYWRpdXM7XHJcbiAgICB2ZWMuZGlyZWN0aW9uID0gLXZlYy5kaXJlY3Rpb247XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgVXBkYXRlID0gKCkgPT4ge1xyXG4gIGNvbnN0IHVwZGF0ZXM6IFtudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIGJvb2xlYW4sIGJvb2xlYW5dW10gPSBbXTtcclxuXHJcbiAgZm9vZHMuZm9yRWFjaChmb29kID0+IG1vdmUoZm9vZCwgZm9vZC5yYWRpdXMsIDAuMikpO1xyXG5cclxuICBhbnRzLmZvckVhY2goYW50ID0+IHtcclxuICAgIG1vdmUoYW50KTtcclxuXHJcbiAgICB3YWxscy5mb3JFYWNoKHdhbGwgPT4ge1xyXG4gICAgICBjb25zdCBpblggPSBhbnQueCA+IHdhbGwuYS54ICYmIGFudC54IDwgd2FsbC5iLng7XHJcbiAgICAgIGNvbnN0IHgwZCA9IGluWCA/IGFudC54IC0gd2FsbC5hLnggOiAwO1xyXG4gICAgICBjb25zdCB4MWQgPSBpblggPyB3YWxsLmIueCAtIGFudC54IDogMDtcclxuICAgICAgY29uc3QgaW5ZID0gYW50LnkgPiB3YWxsLmEueSAmJiBhbnQueSA8IHdhbGwuYi55O1xyXG4gICAgICBjb25zdCB5MGQgPSBpblkgPyBhbnQueSAtIHdhbGwuYS55IDogMDtcclxuICAgICAgY29uc3QgeTFkID0gaW5ZID8gd2FsbC5iLnkgLSBhbnQueSA6IDA7XHJcbiAgICAgIGlmIChpblggJiYgaW5ZKSB7XHJcbiAgICAgICAgLy9DaGVjayBpZiBoaXQgdG9wIG9yIGJvdHRvbSBzaWRlc1xyXG4gICAgICAgIGlmIChNYXRoLm1pbih5MGQsIHkxZCkgPCBNYXRoLm1pbih4MGQsIHgxZCkpIHtcclxuICAgICAgICAgIGFudC5kaXJlY3Rpb24gPSAtYW50LmRpcmVjdGlvbjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgYW50LmRpcmVjdGlvbiA9IE1hdGguUEkgLSBhbnQuZGlyZWN0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtb3ZlKGFudCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChuZWFyKGFudCwgaG9tZSwgaG9tZS5yYWRpdXMpICYmIGFudC5jYXJyeWluZykge1xyXG4gICAgICBhbnQuY2FycnlpbmcgPSBmYWxzZTtcclxuICAgICAgYW50LmhvbWUgPSAwO1xyXG4gICAgICBhbnQuZGlyZWN0aW9uICs9IE1hdGguUEk7XHJcbiAgICAgICsrY29sbGVjdGVkO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghYW50LmNhcnJ5aW5nKSB7XHJcbiAgICAgIGZvb2RzLmZvckVhY2goZm9vZCA9PiB7XHJcbiAgICAgICAgaWYgKG5lYXIoYW50LCBmb29kLCBmb29kLnJhZGl1cykpIHtcclxuICAgICAgICAgIGFudC5jYXJyeWluZyA9IHRydWU7XHJcbiAgICAgICAgICBhbnQuZm9vZCA9IDA7XHJcbiAgICAgICAgICBhbnQuZGlyZWN0aW9uICs9IE1hdGguUEk7XHJcbiAgICAgICAgICBmb29kLnJhZGl1cyAtPSAwLjAwMTtcclxuICAgICAgICAgIGlmIChmb29kLnJhZGl1cyA8IDEpIHtcclxuICAgICAgICAgICAgZm9vZC54ID0gTWF0aC5yYW5kb20oKSAqIHcoKTtcclxuICAgICAgICAgICAgZm9vZC55ID0gTWF0aC5yYW5kb20oKSAqIGgoKTtcclxuICAgICAgICAgICAgZm9vZC5yYWRpdXMgPSA0O1xyXG4gICAgICAgICAgICBmb29kLmRpcmVjdGlvbiA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJICogMjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgICsrYW50LmZvb2Q7XHJcbiAgICArK2FudC5ob21lO1xyXG4gIH0pO1xyXG5cclxuICBhbnRzLmZvckVhY2goYW50ID0+IHtcclxuICAgIGFudHMuZm9yRWFjaChvdGhlciA9PiB7XHJcbiAgICAgIGlmIChhbnQgPT09IG90aGVyKSByZXR1cm47XHJcbiAgICAgIGlmICghbmVhcihhbnQsIG90aGVyLCBzY3JlYW1SYWRpdXMpKSByZXR1cm47XHJcbiAgICAgIGNvbnN0IGYgPSBhbnQuZm9vZCArIHNjcmVhbVJhZGl1cztcclxuICAgICAgY29uc3QgaCA9IGFudC5ob21lICsgc2NyZWFtUmFkaXVzO1xyXG4gICAgICBjb25zdCBjbG9zZXJGb29kID0gZiA8IG90aGVyLmZvb2Q7XHJcbiAgICAgIGNvbnN0IGNsb3NlckhvbWUgPSBoIDwgb3RoZXIuaG9tZTtcclxuICAgICAgY29uc3QgZ29Gb29kID0gIW90aGVyLmNhcnJ5aW5nICYmIGNsb3NlckZvb2Q7XHJcbiAgICAgIGNvbnN0IGdvSG9tZSA9IG90aGVyLmNhcnJ5aW5nICYmIGNsb3NlckhvbWU7XHJcbiAgICAgIGNvbnN0IG5ld0RpciA9XHJcbiAgICAgICAgTWF0aC5hdGFuMihhbnQueSAtIG90aGVyLnksIGFudC54IC0gb3RoZXIueCkgK1xyXG4gICAgICAgIE1hdGgucmFuZG9tKCkgKiAwLjUgLVxyXG4gICAgICAgIDAuMjU7XHJcbiAgICAgIGlmIChjbG9zZXJGb29kKSB7XHJcbiAgICAgICAgb3RoZXIuZm9vZCA9IGY7XHJcbiAgICAgIH0gZWxzZSBpZiAoY2xvc2VySG9tZSkge1xyXG4gICAgICAgIG90aGVyLmhvbWUgPSBoO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjbG9zZXJGb29kIHx8IGNsb3NlckhvbWUpIHtcclxuICAgICAgICB1cGRhdGVzLnB1c2goW2FudC54LCBhbnQueSwgb3RoZXIueCwgb3RoZXIueSwgY2xvc2VyRm9vZCwgY2xvc2VySG9tZV0pO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChnb0Zvb2QgfHwgZ29Ib21lKSB7XHJcbiAgICAgICAgb3RoZXIuZGlyZWN0aW9uID0gbmV3RGlyO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIHVwZGF0ZXM7XHJcbn07XHJcbiIsIiIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0ge307XG5fX3dlYnBhY2tfbW9kdWxlc19fW1wiLi9zcmMvaW5kZXgudHNcIl0oKTtcbiIsIiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==